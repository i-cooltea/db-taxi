# 同步配置界面实现文档

## 概述

本文档描述了任务 9.2 "实现同步配置界面" 的完整实现。该界面提供了完整的数据库同步配置管理功能，包括表选择、映射配置和同步模式设置。

## 实现的功能

### 1. 同步配置管理页面 (SyncConfig.vue)

**位置**: `db-taxi/frontend/src/views/SyncConfig.vue`

**功能**:
- 显示所有同步配置的列表
- 创建新的同步配置
- 编辑现有配置
- 删除配置
- 启动同步任务
- 查看配置的表映射

**UI 特性**:
- 卡片式布局展示配置
- 空状态提示
- 加载状态指示
- 错误处理和显示

### 2. 表选择和映射配置界面 (ConfigModal.vue)

**位置**: `db-taxi/frontend/src/components/ConfigModal.vue`

**功能**:
- 三个标签页的配置界面:
  - **基本配置**: 连接选择、配置名称、默认同步模式、同步计划
  - **表选择**: 浏览远程数据库表、选择要同步的表、配置表映射
  - **高级选项**: 批处理大小、最大并发数、冲突解决策略、数据压缩

**表选择功能**:
- 自动加载远程数据库的表列表
- 复选框选择/取消选择表
- 全选/取消全选功能
- 为每个表配置同步模式（全量/增量）
- 打开详细配置对话框

### 3. 同步模式配置界面

**全局同步模式**:
- 在基本配置标签中设置默认同步模式
- 选项: 全量同步 / 增量同步

**表级同步模式**:
- 在表选择标签中为每个表单独设置同步模式
- 通过下拉菜单快速切换
- 通过配置按钮打开详细配置对话框

### 4. 表映射详细配置 (TableMappingModal.vue)

**位置**: `db-taxi/frontend/src/components/TableMappingModal.vue`

**功能**:
- 配置源表名称（只读）
- 配置目标表名称（可自定义）
- 选择同步模式（全量/增量）
- 设置 WHERE 条件过滤
- 启用/禁用表同步

### 5. 配置卡片组件 (ConfigCard.vue)

**位置**: `db-taxi/frontend/src/components/ConfigCard.vue`

**功能**:
- 显示配置名称和连接信息
- 显示配置状态（已启用/已禁用）
- 显示同步模式和表数量
- 显示批处理大小和最大并发数
- 提供操作按钮：启动同步、查看表、编辑、删除

### 6. 表项组件 (TableItem.vue)

**位置**: `db-taxi/frontend/src/components/TableItem.vue`

**功能**:
- 显示表名称
- 显示表映射关系（源表 → 目标表）
- 复选框选择/取消选择
- 同步模式下拉菜单
- 配置按钮打开详细配置

## 后端 API 支持

### 新增端点

在 `db-taxi/internal/server/server.go` 中添加了新的 API 端点:

```go
connections.GET("/:id/tables", s.getConnectionTables)
```

**功能**: 获取指定连接的远程数据库表列表

**实现**:
```go
func (s *Server) getConnectionTables(c *gin.Context) {
    connectionID := c.Param("id")
    tables, err := s.syncManager.GetSyncManager().GetRemoteTables(c.Request.Context(), connectionID)
    // ... 错误处理和响应
}
```

## 数据流

### 创建同步配置流程

1. 用户点击"创建同步配置"按钮
2. 打开 ConfigModal 对话框
3. 用户在"基本配置"标签中选择连接
4. 系统自动加载该连接的远程表列表
5. 用户切换到"表选择"标签
6. 用户选择要同步的表
7. 用户可以为每个表配置同步模式和映射
8. 用户切换到"高级选项"标签配置性能参数
9. 用户点击"保存配置"
10. 系统调用 API 创建配置
11. 配置列表自动刷新

### 编辑同步配置流程

1. 用户点击配置卡片上的"编辑"按钮
2. 打开 ConfigModal 对话框，预填充现有配置
3. 用户修改配置
4. 用户点击"保存配置"
5. 系统调用 API 更新配置
6. 配置列表自动刷新

## 状态管理

使用 Pinia store (`db-taxi/frontend/src/stores/syncStore.js`) 管理状态:

- `configs`: 所有同步配置列表
- `connections`: 所有数据库连接列表
- `loading`: 加载状态
- `error`: 错误信息

## 样式设计

- 使用渐变色背景的页面头部
- 卡片式布局展示配置
- 响应式设计，支持不同屏幕尺寸
- 悬停效果和过渡动画
- 一致的颜色方案和按钮样式

## 验证和错误处理

- 表单验证：必填字段检查
- API 错误处理：显示友好的错误消息
- 加载状态指示：防止重复提交
- 确认对话框：删除操作前确认

## 满足的需求

根据 `.kiro/specs/database-sync/requirements.md`:

- **Requirement 3.1**: ✅ 浏览远程数据库并显示所有可用的表列表
- **Requirement 3.2**: ✅ 选择要同步的表并保存表同步配置
- **Requirement 3.3**: ✅ 配置表同步规则，设置同步模式（全量/增量）
- **Requirement 3.4**: ✅ 设置表映射，允许自定义本地表名称
- **Requirement 3.5**: ✅ 启用/禁用表同步，更新同步配置并调整同步任务

## 测试建议

1. **功能测试**:
   - 创建新的同步配置
   - 编辑现有配置
   - 删除配置
   - 选择和取消选择表
   - 配置表映射
   - 设置同步模式

2. **边界测试**:
   - 没有可用连接时的行为
   - 没有可用表时的行为
   - 网络错误处理
   - 无效输入处理

3. **UI/UX 测试**:
   - 响应式布局
   - 加载状态显示
   - 错误消息显示
   - 表单验证

## 后续改进建议

1. 添加表预览功能，显示表结构和示例数据
2. 添加批量操作功能，一次配置多个表
3. 添加配置模板功能，快速创建相似配置
4. 添加配置导入导出功能
5. 添加实时验证，检查表名冲突
6. 添加配置历史记录和版本控制

## 总结

任务 9.2 已完全实现，提供了完整的同步配置管理界面，包括：
- ✅ 同步配置的管理页面
- ✅ 表选择和映射配置界面
- ✅ 同步模式配置界面

所有功能都已实现并通过编译测试。
